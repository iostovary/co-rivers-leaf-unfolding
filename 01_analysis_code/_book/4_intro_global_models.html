<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Co-Drivers beyond temperature shape the timing of leaf unfolding in temperate trees - 1&nbsp; Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./5_results_FS_leaf_unfolding.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./4_intro_global_models.html">Methods</a></li><li class="breadcrumb-item"><a href="./4_intro_global_models.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Co-Drivers beyond temperature shape the timing of leaf unfolding in temperate trees</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Preface</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Readme</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_intro_global_models.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Results</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_results_FS_leaf_unfolding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fagus sylvatica</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_results_LD_leaf_unfolding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Larix decidua</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_results_PA_leaf_unfolding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Picea abies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_results_TC_leaf_unfolding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Tilia cordata</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_species_comparison_leaf_unfolding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Species comparison</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#technical-implementation" id="toc-technical-implementation" class="nav-link active" data-scroll-target="#technical-implementation"><span class="header-section-number">1.1</span> Technical implementation</a>
  <ul class="collapse">
  <li><a href="#universal-random-effects" id="toc-universal-random-effects" class="nav-link" data-scroll-target="#universal-random-effects"><span class="header-section-number">1.1.1</span> Universal random effects</a></li>
  <li><a href="#universal-autoregressive-parameter" id="toc-universal-autoregressive-parameter" class="nav-link" data-scroll-target="#universal-autoregressive-parameter"><span class="header-section-number">1.1.2</span> Universal autoregressive parameter</a></li>
  </ul></li>
  <li><a href="#reference-models" id="toc-reference-models" class="nav-link" data-scroll-target="#reference-models"><span class="header-section-number">1.2</span> Reference models</a></li>
  <li><a href="#global-models" id="toc-global-models" class="nav-link" data-scroll-target="#global-models"><span class="header-section-number">1.3</span> Global models</a>
  <ul class="collapse">
  <li><a href="#generation-of-global-model-variations" id="toc-generation-of-global-model-variations" class="nav-link" data-scroll-target="#generation-of-global-model-variations"><span class="header-section-number">1.3.1</span> Generation of global model variations</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations"><span class="header-section-number">1.3.2</span> Limitations</a></li>
  </ul></li>
  <li><a href="#final-models" id="toc-final-models" class="nav-link" data-scroll-target="#final-models"><span class="header-section-number">1.4</span> Final models</a></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics"><span class="header-section-number">1.5</span> Model diagnostics</a></li>
  <li><a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection"><span class="header-section-number">1.6</span> Model selection</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./4_intro_global_models.html">Methods</a></li><li class="breadcrumb-item"><a href="./4_intro_global_models.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Models</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Models</span></h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<p>This section describes the modelling process and the model groups reference, global and final models.</p>
<section id="technical-implementation" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="technical-implementation"><span class="header-section-number">1.1</span> Technical implementation</h2>
<p>Random effects as well as autoregressive parameters for all models and complex fixed effects for the global models were stored in objects and supplied to the different models.</p>
<section id="universal-random-effects" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="universal-random-effects"><span class="header-section-number">1.1.1</span> Universal random effects</h3>
<p>In all models the grouping variable METEO_ID was used. Nested groupings to account for different observers were not possible due to insufficient observer levels within the same time series.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-with-filename-file">
<pre><strong>Random effect.</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>random_simple <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> METEO_ID)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">saveRDS</span>(random_simple, <span class="fu">paste0</span>(path_output_data, <span class="st">"/random_simple.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="universal-autoregressive-parameter" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="universal-autoregressive-parameter"><span class="header-section-number">1.1.2</span> Universal autoregressive parameter</h3>
<p>An autoregressive parameter was used to account for the temporal autocorrelation in the residuals. The parameter was estimated for each METEO_ID.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-with-filename-file">
<pre><strong>Autoregressive parameter.</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>autoregression_simple <span class="ot">&lt;-</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span> year <span class="sc">|</span> METEO_ID)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">saveRDS</span>(autoregression_simple, <span class="fu">paste0</span>(path_output_data, <span class="st">"/autoregression_simple.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
</section>
<section id="reference-models" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="reference-models"><span class="header-section-number">1.2</span> Reference models</h2>
<p>The <strong>traditional reference</strong> models contain only a linear warming term. They represent the typical approach to analyse phenological data. I then tested whether the temperature terms are in fact linear, polynomial or whether both terms are required. Consequently the <strong>refined reference</strong> models contain a linear and a quadratic warming term with or without a cooling term. They serve as a contrast for additional parameters such as tree height or stand height.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="cf">for</span> (phase <span class="cf">in</span> phase_list) {</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="cf">for</span> (species <span class="cf">in</span> species_list) {</span>
<span id="cb3-3"><a href="#cb3-3"></a>    </span>
<span id="cb3-4"><a href="#cb3-4"></a>    data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(path_own_data, <span class="st">"/data_unscaled_"</span>, species, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase), <span class="st">".rds"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>      <span class="fu">rename_fun</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>      <span class="fu">select</span>(<span class="sc">-</span>LEAF_COLOURING_LAG) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>      <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>      <span class="fu">mutate</span>(<span class="at">RELIEF =</span> <span class="fu">factor</span>(RELIEF),</span>
<span id="cb3-9"><a href="#cb3-9"></a>             <span class="at">SOCIAL_SITUATION =</span> <span class="fu">factor</span>(SOCIAL_SITUATION))</span>
<span id="cb3-10"><a href="#cb3-10"></a>    </span>
<span id="cb3-11"><a href="#cb3-11"></a>    random_simple <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(path_output_data, <span class="st">"/random_simple.rds"</span>))</span>
<span id="cb3-12"><a href="#cb3-12"></a>    autoregression_simple <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(path_output_data, <span class="st">"/autoregression_simple.rds"</span>))</span>
<span id="cb3-13"><a href="#cb3-13"></a>    </span>
<span id="cb3-14"><a href="#cb3-14"></a>    models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb3-15"><a href="#cb3-15"></a>      <span class="at">ref_true_mai_int =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb3-16"><a href="#cb3-16"></a>        <span class="fu">lme</span>(<span class="at">fixed =</span> doy <span class="sc">~</span> GDD_mainstream, </span>
<span id="cb3-17"><a href="#cb3-17"></a>            <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> METEO_ID, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple),</span>
<span id="cb3-18"><a href="#cb3-18"></a>        <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>),</span>
<span id="cb3-19"><a href="#cb3-19"></a>      </span>
<span id="cb3-20"><a href="#cb3-20"></a>      <span class="at">ref_true_con_int =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb3-21"><a href="#cb3-21"></a>        <span class="fu">lme</span>(<span class="at">fixed =</span> doy <span class="sc">~</span> GDD_conservative, </span>
<span id="cb3-22"><a href="#cb3-22"></a>            <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> METEO_ID, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple),</span>
<span id="cb3-23"><a href="#cb3-23"></a>        <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>),</span>
<span id="cb3-24"><a href="#cb3-24"></a>      </span>
<span id="cb3-25"><a href="#cb3-25"></a>      <span class="at">ref_true_mai_slo =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb3-26"><a href="#cb3-26"></a>        <span class="fu">lme</span>(<span class="at">fixed =</span> doy <span class="sc">~</span> GDD_mainstream,</span>
<span id="cb3-27"><a href="#cb3-27"></a>            <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> GDD_mainstream <span class="sc">|</span> METEO_ID, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple),</span>
<span id="cb3-28"><a href="#cb3-28"></a>        <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>),</span>
<span id="cb3-29"><a href="#cb3-29"></a></span>
<span id="cb3-30"><a href="#cb3-30"></a>      <span class="at">ref_true_con_slo =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb3-31"><a href="#cb3-31"></a>        <span class="fu">lme</span>(<span class="at">fixed =</span> doy <span class="sc">~</span> GDD_conservative,</span>
<span id="cb3-32"><a href="#cb3-32"></a>            <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> GDD_conservative <span class="sc">|</span> METEO_ID, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple),</span>
<span id="cb3-33"><a href="#cb3-33"></a>        <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>)</span>
<span id="cb3-34"><a href="#cb3-34"></a>      )</span>
<span id="cb3-35"><a href="#cb3-35"></a>   </span>
<span id="cb3-36"><a href="#cb3-36"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(models)) {</span>
<span id="cb3-37"><a href="#cb3-37"></a>        <span class="fu">saveRDS</span>(models, <span class="fu">paste0</span>(path_output_data, <span class="st">"/ref_true"</span>, <span class="st">"_"</span>, species, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase), <span class="st">".rds"</span>))</span>
<span id="cb3-38"><a href="#cb3-38"></a>      } <span class="cf">else</span> {</span>
<span id="cb3-39"><a href="#cb3-39"></a>        <span class="fu">message</span>(<span class="st">"Something for "</span>, species, <span class="st">" "</span>, phase, <span class="st">" failed."</span>)</span>
<span id="cb3-40"><a href="#cb3-40"></a>      }</span>
<span id="cb3-41"><a href="#cb3-41"></a>    }</span>
<span id="cb3-42"><a href="#cb3-42"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="cf">for</span> (phase <span class="cf">in</span> phase_list) {</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="cf">for</span> (species <span class="cf">in</span> species_list) {</span>
<span id="cb4-3"><a href="#cb4-3"></a>    </span>
<span id="cb4-4"><a href="#cb4-4"></a>    data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(path_own_data, <span class="st">"/data_unscaled_"</span>, species, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase), <span class="st">".rds"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>      <span class="fu">rename_fun</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>      <span class="fu">select</span>(<span class="sc">-</span>LEAF_COLOURING_LAG) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>      <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>      <span class="fu">mutate</span>(<span class="at">RELIEF =</span> <span class="fu">factor</span>(RELIEF),</span>
<span id="cb4-9"><a href="#cb4-9"></a>             <span class="at">SOCIAL_SITUATION =</span> <span class="fu">factor</span>(SOCIAL_SITUATION))</span>
<span id="cb4-10"><a href="#cb4-10"></a>    </span>
<span id="cb4-11"><a href="#cb4-11"></a>    models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-12"><a href="#cb4-12"></a>      <span class="at">temp_test_mai_int =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb4-13"><a href="#cb4-13"></a>        <span class="fu">lme</span>(<span class="at">fixed =</span> doy <span class="sc">~</span> <span class="fu">poly</span>(GDD_mainstream, <span class="at">degree =</span> <span class="dv">2</span>), </span>
<span id="cb4-14"><a href="#cb4-14"></a>            <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> METEO_ID, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple),</span>
<span id="cb4-15"><a href="#cb4-15"></a>        <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>),</span>
<span id="cb4-16"><a href="#cb4-16"></a>      </span>
<span id="cb4-17"><a href="#cb4-17"></a>      <span class="at">temp_test_mai_slo =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb4-18"><a href="#cb4-18"></a>        <span class="fu">lme</span>(<span class="at">fixed =</span> doy <span class="sc">~</span> <span class="fu">poly</span>(GDD_mainstream, <span class="at">degree =</span> <span class="dv">2</span>), </span>
<span id="cb4-19"><a href="#cb4-19"></a>            <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> GDD_mainstream <span class="sc">|</span> METEO_ID, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple),</span>
<span id="cb4-20"><a href="#cb4-20"></a>        <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>),</span>
<span id="cb4-21"><a href="#cb4-21"></a>      </span>
<span id="cb4-22"><a href="#cb4-22"></a>      <span class="at">temp_test_con_int =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb4-23"><a href="#cb4-23"></a>        <span class="fu">lme</span>(<span class="at">fixed =</span> doy <span class="sc">~</span> <span class="fu">poly</span>(GDD_conservative, <span class="at">degree =</span> <span class="dv">2</span>), </span>
<span id="cb4-24"><a href="#cb4-24"></a>            <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> METEO_ID, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple),</span>
<span id="cb4-25"><a href="#cb4-25"></a>        <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>),</span>
<span id="cb4-26"><a href="#cb4-26"></a>      </span>
<span id="cb4-27"><a href="#cb4-27"></a>      <span class="at">temp_test_con_slo =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb4-28"><a href="#cb4-28"></a>        <span class="fu">lme</span>(<span class="at">fixed =</span> doy <span class="sc">~</span> <span class="fu">poly</span>(GDD_conservative, <span class="at">degree =</span> <span class="dv">2</span>), </span>
<span id="cb4-29"><a href="#cb4-29"></a>            <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> GDD_conservative <span class="sc">|</span> METEO_ID, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple),</span>
<span id="cb4-30"><a href="#cb4-30"></a>        <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>)</span>
<span id="cb4-31"><a href="#cb4-31"></a>      )</span>
<span id="cb4-32"><a href="#cb4-32"></a>   </span>
<span id="cb4-33"><a href="#cb4-33"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(models)) {</span>
<span id="cb4-34"><a href="#cb4-34"></a>        <span class="fu">saveRDS</span>(models, <span class="fu">paste0</span>(path_output_data, <span class="st">"/temp_test"</span>, <span class="st">"_"</span>, species, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase), <span class="st">".rds"</span>))</span>
<span id="cb4-35"><a href="#cb4-35"></a>      } <span class="cf">else</span> {</span>
<span id="cb4-36"><a href="#cb4-36"></a>        <span class="fu">message</span>(<span class="st">"Something for "</span>, species, <span class="st">" "</span>, phase, <span class="st">" failed."</span>)</span>
<span id="cb4-37"><a href="#cb4-37"></a>      }</span>
<span id="cb4-38"><a href="#cb4-38"></a>    }</span>
<span id="cb4-39"><a href="#cb4-39"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="cf">for</span> (phase <span class="cf">in</span> phase_list) {</span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="cf">for</span> (species <span class="cf">in</span> species_list) {</span>
<span id="cb5-3"><a href="#cb5-3"></a>    </span>
<span id="cb5-4"><a href="#cb5-4"></a>    data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(path_own_data, <span class="st">"/data_unscaled_"</span>, species, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase), <span class="st">".rds"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>      <span class="fu">rename_fun</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>      <span class="fu">select</span>(<span class="sc">-</span>LEAF_COLOURING_LAG) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>      <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>      <span class="fu">mutate</span>(<span class="at">RELIEF =</span> <span class="fu">factor</span>(RELIEF),</span>
<span id="cb5-9"><a href="#cb5-9"></a>             <span class="at">SOCIAL_SITUATION =</span> <span class="fu">factor</span>(SOCIAL_SITUATION))</span>
<span id="cb5-10"><a href="#cb5-10"></a>    </span>
<span id="cb5-11"><a href="#cb5-11"></a>    random_simple <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(path_output_data, <span class="st">"/random_simple.rds"</span>))</span>
<span id="cb5-12"><a href="#cb5-12"></a>    autoregression_simple <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(path_output_data, <span class="st">"/autoregression_simple.rds"</span>))</span>
<span id="cb5-13"><a href="#cb5-13"></a>    </span>
<span id="cb5-14"><a href="#cb5-14"></a>    <span class="co"># create refined reference models</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>    models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb5-16"><a href="#cb5-16"></a>      <span class="at">ref_imp_mai_int_poly =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb5-17"><a href="#cb5-17"></a>        <span class="fu">lme</span>(<span class="at">fixed =</span> doy <span class="sc">~</span> <span class="fu">poly</span>(GDD_mainstream, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> CDD_mainstream, </span>
<span id="cb5-18"><a href="#cb5-18"></a>            <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> METEO_ID, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple),</span>
<span id="cb5-19"><a href="#cb5-19"></a>        <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>),</span>
<span id="cb5-20"><a href="#cb5-20"></a>      </span>
<span id="cb5-21"><a href="#cb5-21"></a>      <span class="at">ref_imp_mai_int_line =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb5-22"><a href="#cb5-22"></a>        <span class="fu">lme</span>(<span class="at">fixed =</span> doy <span class="sc">~</span> GDD_mainstream <span class="sc">*</span> CDD_mainstream, </span>
<span id="cb5-23"><a href="#cb5-23"></a>            <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> METEO_ID, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple),</span>
<span id="cb5-24"><a href="#cb5-24"></a>        <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>),</span>
<span id="cb5-25"><a href="#cb5-25"></a>      </span>
<span id="cb5-26"><a href="#cb5-26"></a>      <span class="at">ref_imp_con_int_poly =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb5-27"><a href="#cb5-27"></a>        <span class="fu">lme</span>(<span class="at">fixed =</span> doy <span class="sc">~</span> <span class="fu">poly</span>(GDD_conservative, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> CDD_conservative, </span>
<span id="cb5-28"><a href="#cb5-28"></a>            <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> METEO_ID, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple),</span>
<span id="cb5-29"><a href="#cb5-29"></a>        <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>),</span>
<span id="cb5-30"><a href="#cb5-30"></a>      </span>
<span id="cb5-31"><a href="#cb5-31"></a>      <span class="at">ref_imp_con_int_line =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb5-32"><a href="#cb5-32"></a>        <span class="fu">lme</span>(<span class="at">fixed =</span> doy <span class="sc">~</span> GDD_conservative <span class="sc">*</span> CDD_conservative, </span>
<span id="cb5-33"><a href="#cb5-33"></a>            <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> METEO_ID, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple),</span>
<span id="cb5-34"><a href="#cb5-34"></a>        <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>)</span>
<span id="cb5-35"><a href="#cb5-35"></a>    )</span>
<span id="cb5-36"><a href="#cb5-36"></a>   </span>
<span id="cb5-37"><a href="#cb5-37"></a>    <span class="cf">for</span> (model_name <span class="cf">in</span> <span class="fu">names</span>(models)) {</span>
<span id="cb5-38"><a href="#cb5-38"></a>      model <span class="ot">&lt;-</span> models[[model_name]]</span>
<span id="cb5-39"><a href="#cb5-39"></a>      </span>
<span id="cb5-40"><a href="#cb5-40"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(model)) {</span>
<span id="cb5-41"><a href="#cb5-41"></a>        selected_subset <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb5-42"><a href="#cb5-42"></a></span>
<span id="cb5-43"><a href="#cb5-43"></a>        dredge_result <span class="ot">&lt;-</span> <span class="fu">dredge</span>(model, </span>
<span id="cb5-44"><a href="#cb5-44"></a>                                  <span class="co"># extra = list("RMSE" = function(x) sqrt(mean(residuals(x)^2))),</span></span>
<span id="cb5-45"><a href="#cb5-45"></a>                                  <span class="at">rank =</span> <span class="fu">list</span>(<span class="at">cAIC =</span> fun_get_caic),</span>
<span id="cb5-46"><a href="#cb5-46"></a>                                  <span class="at">fixed =</span> <span class="fu">c</span>(<span class="st">"poly(GDD_mainstream, degree = 2)"</span>, <span class="st">"GDD_mainstream"</span>, <span class="st">"poly(GDD_conservative, degree = 2)"</span>, <span class="st">"GDD_conservative"</span>)</span>
<span id="cb5-47"><a href="#cb5-47"></a>                                  )</span>
<span id="cb5-48"><a href="#cb5-48"></a>          </span>
<span id="cb5-49"><a href="#cb5-49"></a>          ref <span class="ot">&lt;-</span> <span class="fu">get.models</span>(dredge_result, <span class="at">subset =</span> <span class="cn">TRUE</span>, <span class="at">method =</span> <span class="st">"ML"</span>) <span class="sc">%&gt;%</span> <span class="fu">setNames</span>(<span class="fu">paste0</span>(model_name, <span class="st">"_"</span>, <span class="fu">seq_along</span>(.)))</span>
<span id="cb5-50"><a href="#cb5-50"></a></span>
<span id="cb5-51"><a href="#cb5-51"></a>          </span>
<span id="cb5-52"><a href="#cb5-52"></a>          <span class="fu">saveRDS</span>(ref, <span class="fu">paste0</span>(path_output_data, <span class="st">"/"</span>,</span>
<span id="cb5-53"><a href="#cb5-53"></a>                              model_name, <span class="st">"_"</span>, species, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase), <span class="st">".rds"</span>))</span>
<span id="cb5-54"><a href="#cb5-54"></a>        } <span class="cf">else</span> {</span>
<span id="cb5-55"><a href="#cb5-55"></a>        <span class="fu">message</span>(<span class="st">"Model "</span>, model_name, <span class="st">" for "</span>, species, <span class="st">" "</span>, phase, <span class="st">" failed."</span>)</span>
<span id="cb5-56"><a href="#cb5-56"></a>      }</span>
<span id="cb5-57"><a href="#cb5-57"></a>    }</span>
<span id="cb5-58"><a href="#cb5-58"></a>  }</span>
<span id="cb5-59"><a href="#cb5-59"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="global-models" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="global-models"><span class="header-section-number">1.3</span> Global models</h2>
<p>Based on the hypothesis that the adjusted effects of temperature, drought, stand structure, soil characteristics and topography influence the timing of leaf unfolding two global models (mainstream and conservative) were developed. The method for calculating the temperature sums can impact the results considerably. Consequently the global model “<strong>mainstream”</strong> uses GDD and CDD sums according to the common approach to end accumulation at the mean doy per site, whereas the global model”<strong>conservative”</strong> uses GDD and CDD sums that were ended at the earliest 5% percentile of doys per site.</p>
<section id="fixed-mainstream-effects" class="level4" data-number="1.3.0.1">
<h4 data-number="1.3.0.1" class="anchored" data-anchor-id="fixed-mainstream-effects"><span class="header-section-number">1.3.0.1</span> Fixed mainstream effects</h4>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-with-filename-file">
<pre><strong>Loop to generate all mainstream fixed effects for all species.</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="cf">for</span> (phase <span class="cf">in</span> phase_list) {</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="cf">for</span> (species <span class="cf">in</span> species_list) {</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="cf">if</span> (phase <span class="sc">==</span> <span class="st">"leaf unfolding"</span>) {</span>
<span id="cb6-4"><a href="#cb6-4"></a>      <span class="cf">if</span> (species <span class="sc">==</span> <span class="st">"FS"</span>) { <span class="co"># global model for evergreens</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>        fixed_effects <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(doy <span class="sc">~</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>          <span class="fu">poly</span>(GDD_mainstream, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> CDD_mainstream <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>          <span class="fu">poly</span>(DROUGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(AWC, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>          <span class="fu">poly</span>(SLOPE_ASPECT_HL, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(SLOPE_INCLINATION_DEG, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span> RELIEF <span class="sc">+</span> TREE_ELEVATION <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>          SOCIAL_SITUATION <span class="sc">+</span> <span class="fu">poly</span>(TREE_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(STAND_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>))</span>
<span id="cb6-10"><a href="#cb6-10"></a>      } <span class="cf">else</span> <span class="cf">if</span> (species <span class="sc">==</span> <span class="st">"LD"</span>) {</span>
<span id="cb6-11"><a href="#cb6-11"></a>        fixed_effects <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(doy <span class="sc">~</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>          <span class="fu">poly</span>(GDD_mainstream, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> CDD_mainstream <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>          <span class="fu">poly</span>(DROUGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(AWC, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>          <span class="fu">poly</span>(SLOPE_ASPECT_HL, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(SLOPE_INCLINATION_DEG, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span> RELIEF <span class="sc">+</span> TREE_ELEVATION <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>          SOCIAL_SITUATION <span class="sc">+</span> <span class="fu">poly</span>(TREE_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(STAND_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>))</span>
<span id="cb6-16"><a href="#cb6-16"></a>      } <span class="cf">else</span> <span class="cf">if</span> (species <span class="sc">==</span> <span class="st">"PA"</span>) {</span>
<span id="cb6-17"><a href="#cb6-17"></a>        fixed_effects <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(doy <span class="sc">~</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>          <span class="fu">poly</span>(GDD_mainstream, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> CDD_mainstream <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>          <span class="fu">poly</span>(DROUGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(AWC, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20"></a>          <span class="fu">poly</span>(SLOPE_ASPECT_HL, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(SLOPE_INCLINATION_DEG, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span> RELIEF <span class="sc">+</span> TREE_ELEVATION <span class="sc">+</span></span>
<span id="cb6-21"><a href="#cb6-21"></a>          SOCIAL_SITUATION <span class="sc">+</span> <span class="fu">poly</span>(TREE_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(STAND_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>))</span>
<span id="cb6-22"><a href="#cb6-22"></a>      } <span class="cf">else</span> <span class="cf">if</span> (species <span class="sc">==</span> <span class="st">"TC"</span>){</span>
<span id="cb6-23"><a href="#cb6-23"></a>        fixed_effects <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(doy <span class="sc">~</span></span>
<span id="cb6-24"><a href="#cb6-24"></a>          <span class="fu">poly</span>(GDD_mainstream, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> CDD_mainstream <span class="sc">+</span></span>
<span id="cb6-25"><a href="#cb6-25"></a>          <span class="fu">poly</span>(DROUGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(AWC, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-26"><a href="#cb6-26"></a>          <span class="fu">poly</span>(SLOPE_ASPECT_HL, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(SLOPE_INCLINATION_DEG, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span> RELIEF <span class="sc">+</span> TREE_ELEVATION <span class="sc">+</span></span>
<span id="cb6-27"><a href="#cb6-27"></a>          SOCIAL_SITUATION <span class="sc">+</span> <span class="fu">poly</span>(TREE_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(STAND_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>))</span>
<span id="cb6-28"><a href="#cb6-28"></a>        }</span>
<span id="cb6-29"><a href="#cb6-29"></a>      }</span>
<span id="cb6-30"><a href="#cb6-30"></a>    </span>
<span id="cb6-31"><a href="#cb6-31"></a>    <span class="cf">else</span> { <span class="co"># global model for other phase</span></span>
<span id="cb6-32"><a href="#cb6-32"></a>      fixed_effects <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(doy <span class="sc">~</span> other)</span>
<span id="cb6-33"><a href="#cb6-33"></a>    }</span>
<span id="cb6-34"><a href="#cb6-34"></a>    </span>
<span id="cb6-35"><a href="#cb6-35"></a>    <span class="fu">saveRDS</span>(fixed_effects, <span class="fu">paste0</span>(path_output_data, <span class="st">"/fixed_mainstream_"</span>, species, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase), <span class="st">".rds"</span>))</span>
<span id="cb6-36"><a href="#cb6-36"></a>  }</span>
<span id="cb6-37"><a href="#cb6-37"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="fixed-conservative-effects" class="level4" data-number="1.3.0.2">
<h4 data-number="1.3.0.2" class="anchored" data-anchor-id="fixed-conservative-effects"><span class="header-section-number">1.3.0.2</span> Fixed conservative effects</h4>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-with-filename-file">
<pre><strong>Loop to generate all conservative fixed effects for all species.</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="cf">for</span> (phase <span class="cf">in</span> phase_list) {</span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="cf">for</span> (species <span class="cf">in</span> species_list) {</span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="cf">if</span> (phase <span class="sc">==</span> <span class="st">"leaf unfolding"</span>) {</span>
<span id="cb7-4"><a href="#cb7-4"></a>      <span class="cf">if</span> (species <span class="sc">==</span> <span class="st">"FS"</span>) { <span class="co"># global model for evergreens</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>        fixed_effects <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(doy <span class="sc">~</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>          <span class="fu">poly</span>(GDD_conservative, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> CDD_conservative <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>          <span class="fu">poly</span>(DROUGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(AWC, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>          <span class="fu">poly</span>(SLOPE_ASPECT_HL, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(SLOPE_INCLINATION_DEG, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span> RELIEF <span class="sc">+</span> TREE_ELEVATION <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>          SOCIAL_SITUATION <span class="sc">+</span> <span class="fu">poly</span>(TREE_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(STAND_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>))</span>
<span id="cb7-10"><a href="#cb7-10"></a>      } <span class="cf">else</span> <span class="cf">if</span> (species <span class="sc">==</span> <span class="st">"LD"</span>) {</span>
<span id="cb7-11"><a href="#cb7-11"></a>        fixed_effects <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(doy <span class="sc">~</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>          <span class="fu">poly</span>(GDD_conservative, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> CDD_conservative <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>          <span class="fu">poly</span>(DROUGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(AWC, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>          <span class="fu">poly</span>(SLOPE_ASPECT_HL, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(SLOPE_INCLINATION_DEG, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span> RELIEF <span class="sc">+</span> TREE_ELEVATION <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15"></a>          SOCIAL_SITUATION <span class="sc">+</span> <span class="fu">poly</span>(TREE_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(STAND_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>))</span>
<span id="cb7-16"><a href="#cb7-16"></a>      } <span class="cf">else</span> <span class="cf">if</span> (species <span class="sc">==</span> <span class="st">"PA"</span>) {</span>
<span id="cb7-17"><a href="#cb7-17"></a>        fixed_effects <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(doy <span class="sc">~</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>          <span class="fu">poly</span>(GDD_conservative, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>          <span class="fu">poly</span>(DROUGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(AWC, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>          <span class="fu">poly</span>(SLOPE_ASPECT_HL, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(SLOPE_INCLINATION_DEG, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span> RELIEF <span class="sc">+</span> TREE_ELEVATION <span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>          SOCIAL_SITUATION <span class="sc">+</span> <span class="fu">poly</span>(TREE_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(STAND_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>))</span>
<span id="cb7-22"><a href="#cb7-22"></a>      } <span class="cf">else</span> <span class="cf">if</span> (species <span class="sc">==</span> <span class="st">"TC"</span>){</span>
<span id="cb7-23"><a href="#cb7-23"></a>        fixed_effects <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(doy <span class="sc">~</span></span>
<span id="cb7-24"><a href="#cb7-24"></a>          GDD_conservative <span class="sc">*</span> CDD_conservative <span class="sc">+</span></span>
<span id="cb7-25"><a href="#cb7-25"></a>          <span class="fu">poly</span>(DROUGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(AWC, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>          <span class="fu">poly</span>(SLOPE_ASPECT_HL, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(SLOPE_INCLINATION_DEG, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">+</span> RELIEF <span class="sc">+</span> TREE_ELEVATION <span class="sc">+</span></span>
<span id="cb7-27"><a href="#cb7-27"></a>          SOCIAL_SITUATION <span class="sc">+</span> <span class="fu">poly</span>(TREE_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">poly</span>(STAND_HEIGHT, <span class="at">degree=</span><span class="dv">2</span>))</span>
<span id="cb7-28"><a href="#cb7-28"></a>        }</span>
<span id="cb7-29"><a href="#cb7-29"></a>      }</span>
<span id="cb7-30"><a href="#cb7-30"></a>    </span>
<span id="cb7-31"><a href="#cb7-31"></a>    <span class="cf">else</span> { <span class="co"># global model for other phase</span></span>
<span id="cb7-32"><a href="#cb7-32"></a>      fixed_effects <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(doy <span class="sc">~</span> other)</span>
<span id="cb7-33"><a href="#cb7-33"></a>    }</span>
<span id="cb7-34"><a href="#cb7-34"></a>    </span>
<span id="cb7-35"><a href="#cb7-35"></a>    <span class="fu">saveRDS</span>(fixed_effects, <span class="fu">paste0</span>(path_output_data, <span class="st">"/fixed_conservative_"</span>, species, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase), <span class="st">".rds"</span>))</span>
<span id="cb7-36"><a href="#cb7-36"></a>  }</span>
<span id="cb7-37"><a href="#cb7-37"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="global-model-combinations" class="level4" data-number="1.3.0.3">
<h4 data-number="1.3.0.3" class="anchored" data-anchor-id="global-model-combinations"><span class="header-section-number">1.3.0.3</span> Global model combinations</h4>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-with-filename-file">
<pre><strong>Loop to generate all global models for all species.</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="cf">for</span> (phase <span class="cf">in</span> phase_list) {</span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="cf">for</span> (species <span class="cf">in</span> species_list) {</span>
<span id="cb8-3"><a href="#cb8-3"></a>    </span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="co"># load data</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>    data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(path_own_data, <span class="st">"/data_unscaled_"</span>, species, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase), <span class="st">".rds"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>      <span class="fu">rename_fun</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>      <span class="fu">select</span>(<span class="sc">-</span>LEAF_COLOURING_LAG) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>      <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>      <span class="fu">mutate</span>(<span class="at">RELIEF =</span> <span class="fu">factor</span>(RELIEF),</span>
<span id="cb8-10"><a href="#cb8-10"></a>             <span class="at">SOCIAL_SITUATION =</span> <span class="fu">factor</span>(SOCIAL_SITUATION))</span>
<span id="cb8-11"><a href="#cb8-11"></a>    </span>
<span id="cb8-12"><a href="#cb8-12"></a>    <span class="co"># load fixed effects</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>    fixed_conservative <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(path_output_data, <span class="st">"/fixed_conservative_"</span>, species, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase), <span class="st">".rds"</span>))</span>
<span id="cb8-14"><a href="#cb8-14"></a>    fixed_mainstream <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(path_output_data, <span class="st">"/fixed_mainstream_"</span>, species, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase), <span class="st">".rds"</span>))</span>
<span id="cb8-15"><a href="#cb8-15"></a>    </span>
<span id="cb8-16"><a href="#cb8-16"></a>    <span class="co"># load random effects  </span></span>
<span id="cb8-17"><a href="#cb8-17"></a>    random_simple <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(path_output_data, <span class="st">"/random_simple.rds"</span>))</span>
<span id="cb8-18"><a href="#cb8-18"></a>    </span>
<span id="cb8-19"><a href="#cb8-19"></a>    <span class="co"># load autoregression parameter</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>    autoregression_simple <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(path_output_data, <span class="st">"/autoregression_simple.rds"</span>))</span>
<span id="cb8-21"><a href="#cb8-21"></a></span>
<span id="cb8-22"><a href="#cb8-22"></a>    <span class="co"># mainstream</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>      <span class="co"># random simple</span></span>
<span id="cb8-24"><a href="#cb8-24"></a>      <span class="fu">tryCatch</span>({</span>
<span id="cb8-25"><a href="#cb8-25"></a>      global_maisim  <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">bquote</span>(<span class="fu">lme</span>(<span class="at">fixed =</span> fixed_mainstream, <span class="at">random =</span> random_simple, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple)))</span>
<span id="cb8-26"><a href="#cb8-26"></a>      <span class="fu">saveRDS</span>(global_maisim, <span class="fu">paste0</span>(path_output_data, <span class="st">"/global_mai_"</span>, species, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase), <span class="st">".rds"</span>))</span>
<span id="cb8-27"><a href="#cb8-27"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">message</span>(<span class="st">"Error in model with global_maisim for "</span>, species, <span class="st">" "</span>, phase, <span class="st">": "</span>, e<span class="sc">$</span>message))</span>
<span id="cb8-28"><a href="#cb8-28"></a></span>
<span id="cb8-29"><a href="#cb8-29"></a>    <span class="co"># conservative</span></span>
<span id="cb8-30"><a href="#cb8-30"></a>      <span class="co"># random simple</span></span>
<span id="cb8-31"><a href="#cb8-31"></a>      <span class="fu">tryCatch</span>({</span>
<span id="cb8-32"><a href="#cb8-32"></a>      global_consim <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">bquote</span>(<span class="fu">lme</span>(<span class="at">fixed =</span> fixed_conservative, <span class="at">random =</span> random_simple, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> autoregression_simple)))</span>
<span id="cb8-33"><a href="#cb8-33"></a>      <span class="fu">saveRDS</span>(global_consim, <span class="fu">paste0</span>(path_output_data, <span class="st">"/global_con_"</span>, species, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase), <span class="st">".rds"</span>))</span>
<span id="cb8-34"><a href="#cb8-34"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">message</span>(<span class="st">"Error in model with global_consim for "</span>, species, <span class="st">" "</span>, phase, <span class="st">": "</span>, e<span class="sc">$</span>message))</span>
<span id="cb8-35"><a href="#cb8-35"></a>  }</span>
<span id="cb8-36"><a href="#cb8-36"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="generation-of-global-model-variations" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="generation-of-global-model-variations"><span class="header-section-number">1.3.1</span> Generation of global model variations</h3>
<p>The variations of all global models were created with mumln::dredge. The function was fitted with each global model and set to test all combinations that contained a growing degree day term and ≤ 10 terms in total.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-with-filename-file">
<pre><strong>Execution of mumln:dredge via an array for all global models.</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="do">### Setup </span><span class="al">###</span></span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>location <span class="ot">&lt;-</span> <span class="st">"large_models/"</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>sublocation <span class="ot">&lt;-</span> <span class="st">"input_unscaled_squared_in_model/"</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>data_subset <span class="ot">&lt;-</span> <span class="st">"unscaled_"</span></span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="fu">library</span>(nlme) <span class="co"># linear mixed-effects models</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="fu">library</span>(MuMIn) <span class="co"># automated model selection</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="fu">library</span>(data.table)</span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="fu">library</span>(tidyverse) <span class="co"># data manipulation</span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="fu">library</span>(cAIC4) <span class="co"># conditional Akaike Information Criterion</span></span>
<span id="cb9-12"><a href="#cb9-12"></a></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co"># load standard libraries</span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="fu">source</span>(<span class="fu">paste0</span>(location,<span class="st">"00_helpers/rename_fun.R"</span>))</span>
<span id="cb9-15"><a href="#cb9-15"></a></span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="co"># load random effects and autoregression parameter</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>random_simple <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(location, <span class="st">"own_data/output_data/random_simple.rds"</span>))</span>
<span id="cb9-18"><a href="#cb9-18"></a>autoregression_simple <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(location, <span class="st">"own_data/output_data/autoregression_simple.rds"</span>))</span>
<span id="cb9-19"><a href="#cb9-19"></a></span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="co"># function to extract cAIC and return NA if failed</span></span>
<span id="cb9-21"><a href="#cb9-21"></a>fun_get_caic <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb9-22"><a href="#cb9-22"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb9-23"><a href="#cb9-23"></a>    <span class="fu">cAIC</span>(x)<span class="sc">$</span>caic <span class="co"># accessing the specific value from the cAIC function</span></span>
<span id="cb9-24"><a href="#cb9-24"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb9-25"><a href="#cb9-25"></a>    <span class="cn">NA</span> <span class="co"># return NA or some indication of failure for models that cause an error</span></span>
<span id="cb9-26"><a href="#cb9-26"></a>  })</span>
<span id="cb9-27"><a href="#cb9-27"></a>}</span>
<span id="cb9-28"><a href="#cb9-28"></a></span>
<span id="cb9-29"><a href="#cb9-29"></a><span class="co"># create array ####</span></span>
<span id="cb9-30"><a href="#cb9-30"></a><span class="co"># array for parallelized computing (not required if run on a single machine)</span></span>
<span id="cb9-31"><a href="#cb9-31"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="fu">Sys.getenv</span>(<span class="st">"SLURM_ARRAY_TASK_ID"</span>) <span class="sc">==</span> <span class="st">""</span>)) {</span>
<span id="cb9-32"><a href="#cb9-32"></a>  i <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">Sys.getenv</span>(<span class="st">"SLURM_ARRAY_TASK_ID"</span>))</span>
<span id="cb9-33"><a href="#cb9-33"></a>}</span>
<span id="cb9-34"><a href="#cb9-34"></a></span>
<span id="cb9-35"><a href="#cb9-35"></a>table <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb9-36"><a href="#cb9-36"></a>  <span class="at">species =</span> <span class="fu">c</span>(<span class="st">"FS"</span>, <span class="st">"LD"</span>, <span class="st">"PA"</span>, <span class="st">"TC"</span>),</span>
<span id="cb9-37"><a href="#cb9-37"></a>  <span class="at">phase =</span> <span class="st">"leaf_unfolding"</span>,</span>
<span id="cb9-38"><a href="#cb9-38"></a>  <span class="at">model =</span> <span class="fu">c</span>(<span class="st">"mai"</span>, <span class="st">"con"</span>),</span>
<span id="cb9-39"><a href="#cb9-39"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-40"><a href="#cb9-40"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb9-41"><a href="#cb9-41"></a>  <span class="fu">relocate</span>(ID)</span>
<span id="cb9-42"><a href="#cb9-42"></a></span>
<span id="cb9-43"><a href="#cb9-43"></a>species_ID <span class="ot">&lt;-</span> table[i, <span class="st">"species"</span>]</span>
<span id="cb9-44"><a href="#cb9-44"></a>phase_ID <span class="ot">&lt;-</span> table[i, <span class="st">"phase"</span>]</span>
<span id="cb9-45"><a href="#cb9-45"></a>model_ID <span class="ot">&lt;-</span> table[i, <span class="st">"model"</span>]</span>
<span id="cb9-46"><a href="#cb9-46"></a></span>
<span id="cb9-47"><a href="#cb9-47"></a><span class="co"># load species specific data ####</span></span>
<span id="cb9-48"><a href="#cb9-48"></a>data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(location, <span class="st">"own_data/output_data/data_"</span>, data_subset , species_ID, <span class="st">"_"</span>, phase_ID, <span class="st">".rds"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-49"><a href="#cb9-49"></a>  <span class="fu">rename_fun</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-50"><a href="#cb9-50"></a>  <span class="fu">select</span>(<span class="sc">-</span>LEAF_COLOURING_LAG) <span class="sc">%&gt;%</span></span>
<span id="cb9-51"><a href="#cb9-51"></a>  <span class="co"># make sure data types are set correctly</span></span>
<span id="cb9-52"><a href="#cb9-52"></a>  <span class="fu">mutate</span>(<span class="at">METEO_ID =</span> <span class="fu">factor</span>(METEO_ID),</span>
<span id="cb9-53"><a href="#cb9-53"></a>         <span class="at">RELIEF =</span> <span class="fu">factor</span>(RELIEF),</span>
<span id="cb9-54"><a href="#cb9-54"></a>         <span class="at">SOCIAL_SITUATION =</span> <span class="fu">factor</span>(SOCIAL_SITUATION),</span>
<span id="cb9-55"><a href="#cb9-55"></a>         <span class="at">EDGE_DIST_IMPUTED =</span> <span class="fu">factor</span>(EDGE_DIST_IMPUTED)) <span class="co"># somehow cAIC is really bad with handling factors and it's best to make them explicit, even if R has recognized them correctly when reading the data set</span></span>
<span id="cb9-56"><a href="#cb9-56"></a></span>
<span id="cb9-57"><a href="#cb9-57"></a><span class="co"># load fixed effects</span></span>
<span id="cb9-58"><a href="#cb9-58"></a>fixed_mainstream <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(location, <span class="st">"own_data/output_data/"</span>,</span>
<span id="cb9-59"><a href="#cb9-59"></a>                                   <span class="st">"fixed_mainstream_"</span>, species_ID, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase_ID), <span class="st">".rds"</span>))</span>
<span id="cb9-60"><a href="#cb9-60"></a>fixed_conservative <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(location, <span class="st">"own_data/output_data/"</span>,</span>
<span id="cb9-61"><a href="#cb9-61"></a>                                     <span class="st">"fixed_conservative_"</span>, species_ID, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase_ID), <span class="st">".rds"</span>))</span>
<span id="cb9-62"><a href="#cb9-62"></a></span>
<span id="cb9-63"><a href="#cb9-63"></a><span class="co"># load model</span></span>
<span id="cb9-64"><a href="#cb9-64"></a>model <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(location, <span class="st">"own_data/output_data/"</span>,</span>
<span id="cb9-65"><a href="#cb9-65"></a>                        <span class="st">"global_"</span>, model_ID, <span class="st">"_"</span>, species_ID, <span class="st">"_"</span>, phase_ID, <span class="st">".rds"</span>))</span>
<span id="cb9-66"><a href="#cb9-66"></a></span>
<span id="cb9-67"><a href="#cb9-67"></a><span class="co"># dredge ####</span></span>
<span id="cb9-68"><a href="#cb9-68"></a>dredge_result <span class="ot">&lt;-</span> <span class="fu">dredge</span>(model, <span class="at">extra =</span> <span class="fu">list</span>(<span class="st">"RMSE"</span> <span class="ot">=</span> <span class="cf">function</span>(x) {<span class="fu">sqrt</span>(<span class="fu">mean</span>(<span class="fu">residuals</span>(x)<span class="sc">^</span><span class="dv">2</span>))}),</span>
<span id="cb9-69"><a href="#cb9-69"></a>                        <span class="at">rank =</span> <span class="fu">list</span>(<span class="at">cAIC =</span> fun_get_caic),</span>
<span id="cb9-70"><a href="#cb9-70"></a>                        <span class="at">m.lim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>),</span>
<span id="cb9-71"><a href="#cb9-71"></a>                        <span class="at">fixed =</span> <span class="fu">c</span>(<span class="st">"poly(GDD_mainstream, degree = 2)"</span>, <span class="st">"GDD_mainstream"</span>, <span class="st">"poly(GDD_conservative, degree = 2)"</span>, <span class="st">"GDD_conservative"</span>)</span>
<span id="cb9-72"><a href="#cb9-72"></a>                        )</span>
<span id="cb9-73"><a href="#cb9-73"></a></span>
<span id="cb9-74"><a href="#cb9-74"></a><span class="co"># remove failed models from the results</span></span>
<span id="cb9-75"><a href="#cb9-75"></a>dredge_result_clean <span class="ot">&lt;-</span> <span class="fu">subset</span>(dredge_result, <span class="at">subset =</span> <span class="sc">!</span><span class="fu">is.na</span>(cAIC))</span>
<span id="cb9-76"><a href="#cb9-76"></a></span>
<span id="cb9-77"><a href="#cb9-77"></a><span class="co"># subset delta 4 and recalculate weights</span></span>
<span id="cb9-78"><a href="#cb9-78"></a>dredge_result_d4 <span class="ot">&lt;-</span> <span class="fu">subset</span>(dredge_result_clean, <span class="at">subset =</span> delta <span class="sc">&lt;</span> <span class="dv">4</span>)</span>
<span id="cb9-79"><a href="#cb9-79"></a><span class="fu">Weights</span>(dredge_result_d4<span class="sc">$</span>cAIC)</span>
<span id="cb9-80"><a href="#cb9-80"></a></span>
<span id="cb9-81"><a href="#cb9-81"></a><span class="co"># subset delta 2 and recalculate weights</span></span>
<span id="cb9-82"><a href="#cb9-82"></a>dredge_result_d2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(dredge_result_clean, <span class="at">subset =</span> delta <span class="sc">&lt;</span> <span class="dv">2</span>)</span>
<span id="cb9-83"><a href="#cb9-83"></a><span class="fu">Weights</span>(dredge_result_d2<span class="sc">$</span>cAIC)</span>
<span id="cb9-84"><a href="#cb9-84"></a></span>
<span id="cb9-85"><a href="#cb9-85"></a><span class="co"># remove large object for faster processing</span></span>
<span id="cb9-86"><a href="#cb9-86"></a><span class="fu">rm</span>(dredge_result_clean)</span>
<span id="cb9-87"><a href="#cb9-87"></a></span>
<span id="cb9-88"><a href="#cb9-88"></a><span class="co"># get most parsimonious models</span></span>
<span id="cb9-89"><a href="#cb9-89"></a>parsimonious_d4 <span class="ot">&lt;-</span> <span class="fu">get.models</span>(dredge_result_d4, <span class="at">subset =</span> <span class="fu">order</span>(dredge_result_d4<span class="sc">$</span>df)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb9-90"><a href="#cb9-90"></a>parsimonious_d2 <span class="ot">&lt;-</span> <span class="fu">get.models</span>(dredge_result_d2, <span class="at">subset =</span> <span class="fu">order</span>(dredge_result_d2<span class="sc">$</span>df)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb9-91"><a href="#cb9-91"></a></span>
<span id="cb9-92"><a href="#cb9-92"></a><span class="co"># extract weights</span></span>
<span id="cb9-93"><a href="#cb9-93"></a>summary_weight_d4 <span class="ot">&lt;-</span> <span class="fu">sw</span>(dredge_result_d4) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="st">"PARAMETER"</span>) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">WEIGHT=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">MODEL=</span> model_ID)</span>
<span id="cb9-94"><a href="#cb9-94"></a>summary_weight_d2 <span class="ot">&lt;-</span> <span class="fu">sw</span>(dredge_result_d2) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="st">"PARAMETER"</span>) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">WEIGHT=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">MODEL=</span> model_ID)</span>
<span id="cb9-95"><a href="#cb9-95"></a></span>
<span id="cb9-96"><a href="#cb9-96"></a><span class="co"># save three best models</span></span>
<span id="cb9-97"><a href="#cb9-97"></a>best_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"best_"</span>, model_ID, <span class="st">"_1"</span>),</span>
<span id="cb9-98"><a href="#cb9-98"></a>                <span class="fu">paste0</span>(<span class="st">"best_"</span>, model_ID, <span class="st">"_2"</span>),</span>
<span id="cb9-99"><a href="#cb9-99"></a>                <span class="fu">paste0</span>(<span class="st">"best_"</span>, model_ID, <span class="st">"_3"</span>))</span>
<span id="cb9-100"><a href="#cb9-100"></a>best <span class="ot">&lt;-</span> <span class="fu">get.models</span>(dredge_result_d2, <span class="at">subset =</span> <span class="fu">order</span>(cAIC)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">method =</span> <span class="st">"ML"</span>) <span class="sc">%&gt;%</span> <span class="fu">setNames</span>(best_names)</span>
<span id="cb9-101"><a href="#cb9-101"></a><span class="fu">saveRDS</span>(best, <span class="fu">paste0</span>(location, <span class="st">"own_data/output_data/"</span>, <span class="co">#sublocation,</span></span>
<span id="cb9-102"><a href="#cb9-102"></a>                     <span class="st">"best_"</span>, model_ID, <span class="st">"_"</span>, species_ID, <span class="st">"_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, phase_ID), <span class="st">".rds"</span>))</span>
<span id="cb9-103"><a href="#cb9-103"></a></span>
<span id="cb9-104"><a href="#cb9-104"></a><span class="co"># save result ####</span></span>
<span id="cb9-105"><a href="#cb9-105"></a><span class="fu">saveRDS</span>(<span class="fu">list</span>(</span>
<span id="cb9-106"><a href="#cb9-106"></a>  <span class="at">model_name =</span> model_ID,</span>
<span id="cb9-107"><a href="#cb9-107"></a>  <span class="at">dredge_result =</span> dredge_result,</span>
<span id="cb9-108"><a href="#cb9-108"></a>  <span class="at">dredge_result_d4 =</span> dredge_result_d4,</span>
<span id="cb9-109"><a href="#cb9-109"></a>  <span class="at">dredge_result_d2 =</span> dredge_result_d2,</span>
<span id="cb9-110"><a href="#cb9-110"></a>  <span class="at">parsimonious_d4 =</span> parsimonious_d4,</span>
<span id="cb9-111"><a href="#cb9-111"></a>  <span class="at">parsimonious_d2 =</span> parsimonious_d2,</span>
<span id="cb9-112"><a href="#cb9-112"></a>  <span class="at">summary_weight_d4 =</span> summary_weight_d4,</span>
<span id="cb9-113"><a href="#cb9-113"></a>  <span class="at">summary_weight_d2 =</span> summary_weight_d2</span>
<span id="cb9-114"><a href="#cb9-114"></a>),</span>
<span id="cb9-115"><a href="#cb9-115"></a><span class="fu">paste0</span>(location,<span class="st">"own_data/output_data/"</span>, <span class="co"># sublocation,</span></span>
<span id="cb9-116"><a href="#cb9-116"></a>       <span class="st">"dredge_"</span>, model_ID, <span class="st">"_"</span>, species_ID, <span class="st">"_"</span>, phase_ID, <span class="st">".rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Parameter weights were calculated for all models with delta cAIC &lt; 4 and &lt; 2 <span class="citation" data-cites="burnham2002">[@burnham2002]</span> for further consideration and the three models with the lowest cAIC (<strong>best models</strong>) and the models with the least number of parameters (<strong>parsimonious models</strong>) were extracted for further analysis.</p>
</section>
<section id="limitations" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="limitations"><span class="header-section-number">1.3.2</span> Limitations</h3>
<p>We wanted to adjust the social situation with an interaction with edge distance. However, this led to issues with the covariance matrix. Edge-distance was removed, because it has little validity as a main effect. Furthermore, it would have been useful to test the global model with a warming term in interaction with all other terms. However, this is computationally expensive. Therefore, only the most important interactions were kept. Due to a substantial amount of missing values for leaf colouring containing it was removed from the global models.</p>
</section>
</section>
<section id="final-models" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="final-models"><span class="header-section-number">1.4</span> Final models</h2>
<p>The final models were generated from the best and most parsimonious model variations of the global model. They demonstrate what the effects of important parameters could look like and how good they would be with prediction. If the quadratic term was significant, non-significant linear terms were kept. If only the linear term was significant, the quadratic term was discarded. Interactions were only kept where significant.</p>
</section>
<section id="model-diagnostics" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="model-diagnostics"><span class="header-section-number">1.5</span> Model diagnostics</h2>
<p>Compliance with model assumptions was assessed with a residual analysis for each set of species specific models. Multicollinearity was assessed with the corvif function by <span class="citation" data-cites="zuur2009">@zuur2009</span>. Cooks distance and leverage was assessed with HLMdiag::cooks.distance and HLMdiag::leverage because more common packages and functions were incompatible with nlme::lme-objects. Some models with temperature parametrized to the mean site leaf unfolding date (mainstream) had issues with residual distributions. Therefore only models with temperature parametrized to the <span class="math inline">\(Q_{0.05}\)</span> site leaf unfolding date (conservative) were considered for the model selection.</p>
</section>
<section id="model-selection" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="model-selection"><span class="header-section-number">1.6</span> Model selection</h2>
<p>Models that met all diagnostic criteria were selected and compared using the cAIC and RMSE.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link  aria-label=" readme"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Readme</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./5_results_FS_leaf_unfolding.html" class="pagination-link" aria-label="<span class='chapter-number'>2</span>&nbsp; <span class='chapter-title'>Fagus sylvatica</span>">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fagus sylvatica</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>